<h4 id='h3label'>المسار الى <%= @agent.name %> على الخريطة:<a href="#directionsPanel"  class='btn btn-success' style="float:left;"> <i style="color:white; " >رؤية التفاصيل و المسافات</i></a> </h4>
<div id="map_route" style="width:100%; height:600px"></div>   
  <div style="display:none" id="directionsPanel"></div>
<%= link_to 'عودة', url_for(:back), :class => "btn btn-primary", :style => "width:200px;" %>

<script type="text/javascript">

var latlng = new google.maps.LatLng(31.44235,31.68369);
    var myOptions = {
      zoom: 14,
      center: latlng,
      mapTypeId: google.maps.MapTypeId.HYBRID,
      mapTypeControl: false
    };
    var map = new google.maps.Map(document.getElementById("map_route"),myOptions);

  var infoWindow1 = new google.maps.InfoWindow({map: map});
  var infoWindow2 = new google.maps.InfoWindow({map: map});
      if (navigator.geolocation) {
    navigator.geolocation.getCurrentPosition(function(position) {
       pos = {
        lat: position.coords.latitude,
        lng: position.coords.longitude
      };


  var directionDisplay;
  var directionsService = new google.maps.DirectionsService();
  directionsDisplay = new google.maps.DirectionsRenderer();
  directionsDisplay.setMap(map);
  directionsDisplay.setPanel(document.getElementById("directionsPanel"));



  // function find_and_calculate_Route() {
    var start = pos;
    var end = '<%= @agent.latitude %>,<%= @agent.langitude %>';

    var request = {
      origin:start,
      destination:end,
      travelMode: google.maps.DirectionsTravelMode.DRIVING
    };

    directionsService.route(request, function(response, status) {
      if (status == google.maps.DirectionsStatus.OK) {
        directionsDisplay.setDirections(response);
       }
    });
     pos_of_destination = {
        lat: <%= @agent.latitude %>,
        lng: <%= @agent.langitude %>
      };
      infoWindow1.setPosition(pos);
      infoWindow1.setContent('هنا موقعك.');
      //map.setCenter(pos);
      infoWindow2.setPosition(pos_of_destination);
      infoWindow2.setContent('موقع ' +'<%= @agent.name %>');

    }, function() {
      handleLocationError(true, infoWindow, map.getCenter());
    });
  } else {
    // Browser doesn't support Geolocation
    handleLocationError(false, infoWindow, map.getCenter());
  }
  function handleLocationError(browserHasGeolocation, infoWindow, pos) {
  infoWindow.setPosition(pos);
  infoWindow.setContent(browserHasGeolocation ?
                        'Error: The Geolocation service failed.' :
                        'Error: Your browser doesn\'t support geolocation.');
}

setTimeout(function(){
	$('#adp-placemark > tbody > tr > td.adp-text').html('<h4 style="color:blue">'+'البداية من موقعك انت'+' </h4>');

$('#directionsPanel > div > div:nth-child(3) > div:nth-child(3) > table > tbody > tr > td.adp-text').html('<h4 style="color:blue">النهاية عند : <%= @agent.name %></h4>');
$('#directionsPanel').css("display","block");


},2000);
	
</script>